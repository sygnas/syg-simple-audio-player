!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):t["syg-simple-audio-player"]=s()}(this,function(){"use strict";var t=function(){function t(t,s){for(var i=0;i<s.length;i++){var e=s[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(s,i,e){return i&&t(s.prototype,i),e&&t(s,e),s}}(),s=function(){function s(t){!function(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}(this,s),this.TYPE_HDS="hds",this.TYPE_HLS="hls",this.TYPE_MSE="mse",this.TYPE_FILE="file";this.opt=Object.assign({hds:{protcol:"http://",playlist:"/manifest.f4m"},hls:{protcol:"http://",playlist:"/playlist.m3u8"},mse:{protcol:"http://",playlist:"/manifest.mpd",autoplay:!1}},t),this.audio=new Audio,this.dash_player=null,this.is_support_hds=!1,this.is_support_hls=!1,this.is_support_mse=!1,this.now_type=null}return t(s,[{key:"check_support",value:function(){try{this.is_support_hds=function(t){return"maybe"===t.canPlayType("application/f4m+xml")}(this.audio),this.is_support_hls=function(t){return"maybe"===t.canPlayType("application/vnd.apple.mpegURL")}(this.audio),this.is_support_mse=function(){var t=null!==window.WebKitMediaSource&&void 0!==window.WebKitMediaSource,s=null!==window.MediaSource&&void 0!==window.MediaSource;return t||s}(this.audio)}catch(t){return!1}return!0}},{key:"set_src",value:function(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return s===this.TYPE_FILE?this.$_set_src_file(t):s===this.TYPE_HLS?this.$_set_src_hls(t):s===this.TYPE_HDS?this.$_set_src_hds(t):s===this.TYPE_MSE?this.$_set_src_mse(t):this.is_support_hls?this.$_set_src_hls(t):this.is_support_hds?this.$_set_src_hds(t):!!this.is_support_mse&&this.$_set_src_mse(t)}},{key:"$_set_src_file",value:function(t){return this.audio.src=t,this.now_type=this.TYPE_FILE,!0}},{key:"$_set_src_hls",value:function(t){return!!this.is_support_hls&&(this.audio.src=this.opt.hls.protcol+t+this.opt.hls.playlist,this.now_type=this.TYPE_HLS,!0)}},{key:"$_set_src_hds",value:function(t){return!!this.is_support_hds&&(this.audio.src=this.opt.hds.protcol+t+this.opt.hds.playlist,this.now_type=this.TYPE_HDS,!0)}},{key:"$_set_src_mse",value:function(t){if(!this.is_support_mse)return!1;this.now_type=this.TYPE_MSE;var s=this.opt.mse.protcol+t+this.opt.mse.playlist;return null===this.dash_player?(this.dash_player=dashjs.MediaPlayer().create(),this.dash_player.initialize(this.audio,s,this.opt.mse.autoplay)):this.dash_player.attachSource(s),!0}}]),s}(),i=function(){function t(t,s){for(var i=0;i<s.length;i++){var e=s[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(s,i,e){return i&&t(s.prototype,i),e&&t(s,e),s}}();return function(){function t(i,e,n){!function(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}(this,t),this.STATE_PLAY="play",this.STATE_PAUSE="pause",this.STATE_STOP="stop";this.opt=Object.assign({attr_src:"data-audio-src",attr_status:"data-audio-status",attr_type:"data-audio-type",hds:{protcol:"http://",playlist:"/manifest.f4m"},hls:{protcol:"http://",playlist:"/playlist.m3u8"},mse:{protcol:"http://",playlist:"/manifest.mpd",autoplay:!1}},n),this.is_playing=!1,this.now_playing_btn=null,this.targets=document.querySelectorAll(i),this.audio_src=new s({hds:this.opt.hds,hls:this.opt.hls,mse:this.opt.mse}),this.$_init_event()}return i(t,[{key:"stop",value:function(){this.$_stop()}},{key:"$_init_event",value:function(){var t=this;(function(t){return Array.prototype.slice.call(t,0)})(this.targets).forEach(function(s){s.addEventListener("click",t.$_on_btn_click.bind(t))}),this.audio_src.audio.addEventListener("ended",this.$_stop.bind(this))}},{key:"$_on_btn_click",value:function(t){t.preventDefault(),t.target===this.now_playing_btn?this.$_pause(t.target):this.$_play_new(t.target)}},{key:"$_stop",value:function(){this.audio_src.audio.pause(),this.audio_src.audio.currentTime=0,this.$_change_state(this.STATE_STOP,this.now_playing_btn),this.now_playing_btn=null}},{key:"$_pause",value:function(t){this.is_playing?(this.audio_src.audio.pause(),this.$_change_state(this.STATE_PAUSE,t)):(this.audio_src.audio.play(),this.$_change_state(this.STATE_PLAY,t))}},{key:"$_play_new",value:function(t){var s=this.opt,i=this.audio_src;this.now_playing_btn&&(i.audio.pause(),this.$_change_state(this.STATE_STOP,this.now_playing_btn));var e=t.getAttribute(s.attr_src),n=t.getAttribute(s.attr_type);if(n===i.TYPE_FILE)i.set_src(e,i.TYPE_FILE);else if(null===n&&this.audio_src.check_support())i.set_src(e);else{if(n!==i.TYPE_HDS&&n!==i.TYPE_HLS&&n!==i.TYPE_MSE){var a=new Error;throw a.message="not supported type.",a}i.set_src(e,n)}i.audio.load(),i.audio.play(),this.now_playing_btn=t,this.$_change_state(this.STATE_PLAY,t)}},{key:"$_change_state",value:function(t,s){t===this.STATE_PLAY?this.is_playing=!0:t!==this.STATE_PAUSE&&t!==this.STATE_STOP||(this.is_playing=!1),s&&s.setAttribute(this.opt.attr_status,t)}}]),t}()});
//# sourceMappingURL=syg-simple-audio-player.min.js.map
